{"version":3,"sources":["mybb-autocomplete.js"],"names":["MyBBAutocomplete","customOptions","selector","options","bank","only","char","vals","lang","blank","more","none","unexp","error","isNumeric","conf","n","isNaN","parseFloat","isFinite","$","fn","fyl","opts","extend","main","fyd","attr","fyls","fylr","after","clone","pop","find","err","outerWidth","width","nVal","each","trim","val","split","i","append","replace","reX","document","on","e","stopPropagation","clk","event","target","id","addClass","slideDown","focus","className","name","text","remove","parent","keyup","inVal","sx","inLen","length","errStr","show","html","hide","ajax","url","type","data","cache","success","json","isJ","JSON","parse","ins","exist","item","inArray","erm","xhr","desc","complete","css","outerHeight","removeClass","slice","t","parseHTML","jQuery"],"mappings":"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","file":"mybb-autocomplete.js","sourcesContent":["/**\n * MyBB Autocomplete\n * \n * @author: effone <me@eff.one>\n * @author: Eric Jackson\n * @website: https://github.com/effone/jquery.fyl\n * @license: MIT\n */\n\nclass MyBBAutocomplete {\n    constructor (customOptions, selector) {\n        let options = Object.assign({\n            bank: '',\n            only: false,\n            char: 3,\n            vals: '',\n            lang: {\n                blank: \"Min {x} chars.\",\n                more: \"{x} more chars.\",\n                none: \"No match.\",\n                unexp: \"Bad data.\",\n                error: \"Error!\"\n            }\n        }, customOptions);\n\n        if (!isNumeric(options.char) || options.char < 1) {\n            conf.char = 1;\n        }\n\n        const isNumeric = (n) => { !isNaN(parseFloat(n)) && isFinite(n) };\n    }\n}\n\n; (function ($) {\n    $.fn.fyl = function (opts) {\n        var conf = $.extend({\n            bank: '',\n            only: false,\n            char: 3,\n            vals: '',\n            lang: {\n                blank: \"Min {x} chars.\",\n                more: \"{x} more chars.\",\n                none: \"No match.\",\n                unexp: \"Bad data.\",\n                error: \"Error!\"\n            }\n        }, opts);\n\n        if (!$.isNumeric(conf.char) || conf.char < 1) { conf.char = 1; }\n        var main = $(this);\n        var fyd = 'fyl-' + main.attr('id');\n        var fyls = '<span class=\\'fyls\\'>{i}<span class=\\'fylx\\'>&#10006;</span></span>';\n        var fylr = '<div class=\\'fylr\\'>{r}</div>'\n\n\n        main.after('<div id=\\'' + fyd + '\\'><div class=\\'pop\\'><input type=\\'text\\' class=\\'srch\\' placeholder=\\'Search\\' autocomplete=\\'off\\'><span class=\\'spin\\'></span><div class=\\'err\\'></div><div class=\\'rslt\\'></div></div></div>');//.hide();\n        var clone = $('#' + fyd);\n        var pop = clone.find('.pop');\n        var err = pop.find('.err');\n        clone.outerWidth(main.outerWidth());\n        pop.width(clone.width());\n        // Add the predefined values\n        var nVal = 0;\n        $.each($.trim(!$.trim(conf.vals) ? main.val() : conf.vals).split(','), function (i, val) {\n            if (!conf.only) { nVal = 0; }\n            if ($.trim(val) && nVal < 1) {\n                clone.append(fyls.replace('{i}', $.trim(val)));\n                nVal++;\n            }\n        });\n        reX();\n\n\n        $(document).on('click', function () { reX(); });\n\n        clone.on('click', function (e) {\n            e.stopPropagation();\n            var clk = event.target;\n            if (clk.id == fyd) {\n                $(this).addClass('open').find('.pop').slideDown('fast').find('.srch').focus();\n            } else if (clk.className == 'fylr') {\n                var name = $(clk).text();\n                if (conf.only) {\n                    $(this).find('.fyls').remove();\n                }\n                $(this).append(fyls.replace('{i}', name));\n                reX();\n            } else if (clk.className == 'fylx') {\n                $(clk).parent().remove();\n                reX();\n            }\n        });\n\n        pop.find('.srch').keyup(function () {\n            pop.find('.fylr').remove();\n            var inVal = sx($(this).val());\n            var inLen = inVal.length;\n            if (inLen < conf.char) {\n                var errStr = inLen > 0 ? 'more' : 'blank';\n                err.show().html(conf.lang[errStr].replace('{x}', conf.char - inLen));\n            } else {\n                err.hide();\n                pop.find('.spin').show();\n                $.ajax({\n                    url: conf.bank,\n                    type: 'post',\n                    data: { 'search': inVal },\n                    cache: false,\n                    success: function (json) {\n                        var isJ = true;\n                        try { JSON.parse(json); } catch (e) { isJ = false; }\n                        pop.find('.fylr').remove();\n                        var ins = 0;\n                        if (isJ) {\n                            var exist = $(main).val().split(',');\n                            $.each(JSON.parse(json), function (i, item) {\n                                if ($.inArray(sx(item), exist) === -1) {\n                                    pop.find('.rslt').append(fylr.replace('{r}', $.trim(item)));\n                                    ins++;\n                                }\n                            });\n                        }\n                        if (ins == 0) {\n                            var erm = isJ ? 'none' : 'unexp';\n                            err.html(conf.lang[erm]).show();\n                        }\n                    },\n                    error: function (xhr, desc, err) {\n                        // console.log(xhr.status + \" - \" + desc + \" - \" + err);\n                        pop.find('.fylr').remove();\n                        err.html(conf.lang.error).show();\n                    },\n                    complete: function () {\n                        pop.find('.spin').hide();\n                    }\n                });\n            }\n        });\n\n        function reX() {\n            pop.find('.fylr').remove();\n            pop.find('.spin').hide();\n            pop.css('margin-top', clone.outerHeight() - 2 + 'px').hide().find('.srch').val('');\n            clone.removeClass('open').find('.err').show().html(conf.lang.blank.replace('{x}', conf.char));\n            main.val(clone.find('.fyls').text().replace(/✖/g, ',').slice(0, -1));\n        }\n\n        function sx(t) { return $.trim($($.parseHTML(t)).text()); }\n    };\n}(jQuery));"]}